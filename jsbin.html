
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
</head>
<body >
<canvas width="200px" height="200px" id="canvas" style="border:solid 1px #000;"></canvas>
<h2>RESULTS</h2>
<p id="res"></p>
<div id="data"></div>
<script src="cleaner.js"></script>
<script src="spiral.js"></script>
<script src="snaking.js"></script>
<script>

var c = null;
function addRobot(){
  c = new Snaking(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height),6,"#5f1",Math.random()*Math.PI*2, 3);
}

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
addRobot();
var max_runs = 1;
var run_count = 0;
var current_p = 0;
var steps = 0;
var last_percentage = 0;
var percentage = 0;
var data_storage = [];

var refesh_rate = 5;

ctx.fillStyle="#fff";

function display_data() {
    for(var e = 0; e < 95; e++) {
        data_storage[e] = Math.floor(data_storage[e]/max_runs);
        document.write(data_storage[e] + " ");
    }

}

function restart() {
    if(run_count == max_runs-1) {
        display_data();
    } else {
        addRobot();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        run_count++;
        steps = 0;
        last_percentage = 0;
        percentage = 0;
        current_p = 0;
        interval = setInterval(run,refesh_rate);
    }
}

function run(){

  ctx.globalAlpha=0.5;
  ctx.strokeStyle="#000";
  ctx.lineWidth=2;
  ctx.fillStyle="#050";

  c.move();
  c.render();
  steps++;
  percentage = pixels(ctx);
  if(percentage-last_percentage >= 0.01) {
      data_storage[current_p] += steps;
      document.write(data_storage[current_p]);
      current_p++;
  }
  last_percentage = percentage;
  if(percentage >= 0.95) {
      clearInterval(interval);
      restart();
  }
}

function pixels(ctx){
  count=0;
  var imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  for (var i=3;i<imgData.data.length;i+=4) if(imgData.data[i]>0)count++;
  return count/(imgData.data.length/4);

}

var interval = setInterval(run,refesh_rate);

</script>
</body>
</html>
