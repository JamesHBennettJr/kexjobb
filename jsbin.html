
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
</head>
<body >
<canvas width="100px" height="100px" id="canvas" style="border:solid 1px #000;"></canvas>
<br>Results
<table id="results">
  <tr>
    <th>run</th>
    <th>0.5</th>
    <th>0.8</th>
    <th>0.95</th>
  </tr>
</table>
<script src="cleaner.js"></script>
<script src="spiral.js"></script>
<script>
function addData(run,data){
  if(document.getElementById("r"+run) == undefined) {
    var r = document.createElement("tr");
    r.id = "r"+run;
    var h = document.createElement("td");
    h.innerHTML=run;
    r.appendChild(h);
    document.getElementById("results").appendChild(r);
  }
  var d = document.createElement("td");
  d.innerHTML=data+", "+Math.round((100*c.totalAng)/(2*Math.PI))/100;
  document.getElementById("r"+run).appendChild(d);

}
var c = null;
function addRobot(){
  c = new Cleaner(canvas.width*Math.random(),canvas.height*Math.random(),3,"#5f1",Math.PI*2*Math.random(), 3);
}



var interval = setInterval(run,50);

var steps = 0;
var run = 0;
var lastPercentage = 0;


function reset(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  addRobot();
  steps = 0;
  run++;
  lastPercentage=0;
}

addRobot();
function run(){
  console.log(c.totalAng/(2*Math.PI));
  ctx.globalAlpha=1;
  ctx.strokeStyle="#000";
  ctx.lineWidth=2;
  ctx.fillStyle="#fff";

  ctx.strokeRect(0,0,canvas.width,canvas.height);
  c.move();
  c.render();
  steps++;
  var percentage = pixels(ctx);
  if(percentage>=0.5 && lastPercentage<0.5) {
    lastPercentage = percentage;
    addData(run,steps);
  }
  if(percentage>=0.8 &&lastPercentage<0.8) {
    lastPercentage = percentage;
    addData(run,steps);
  }
  if(percentage>=0.95 && lastPercentage<0.95) {
    lastPercentage = percentage;
    addData(run,steps);
    reset();
  }

}

function pixels(ctx){
  count=0;
  var imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  for (var i=0;i<imgData.data.length;i+=4) if(imgData.data[i+3]>0)count++;
  return count/imgData.data.length*4;
}



</script>
</body>
</html>
