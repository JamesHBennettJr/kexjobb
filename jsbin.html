
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
</head>
<body >
<canvas width="200px" height="200px" id="canvas" style="border:solid 1px #000;"></canvas>
<br>Results
<table id="results">
  <tr>
    <th>run</th>
    <th>0.5</th>
    <th>angle</th>
    <th>0.8</th>
    <th>angle</th>
    <th>0.95</th>
    <th>angle</th>
  </tr>
</table>
<div id="data"></div>
<script src="cleaner.js"></script>
<script src="spiral.js"></script>
<script src="snaking.js"></script>
<script>
function addData(run,data){
  if(document.getElementById("r"+run) == undefined) {
    var r = document.createElement("tr");
    r.id = "r"+run;
    var h = document.createElement("td");
    h.innerHTML=run;
    r.appendChild(h);
    document.getElementById("results").appendChild(r);
  }
  var d1 = document.createElement("td");
  var d2 = document.createElement("td");
  d1.innerHTML=data;
  d2.innerHTML=Math.round((10*c.totalAng)/(2*Math.PI))/10;
  document.getElementById("r"+run).appendChild(d1);
  document.getElementById("r"+run).appendChild(d2);

}
var c = null;
function addRobot(){
  c = new Snaking(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height),6,"#5f1",Math.random()*Math.PI*2, 3);
}

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
addRobot();


var steps = 0;
var runNumber = 0;
var lastPercentage = 0;
var percentage = 0;

var interval = setInterval(run,5);

function reset(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  addRobot();
  steps = 0;
  runNumber++;
  lastPercentage=0;
  percentage = 0;
}
ctx.fillStyle="#fff";


function run(){

  ctx.globalAlpha=0.5;
  ctx.strokeStyle="#000";
  ctx.lineWidth=2;
  ctx.fillStyle="#050";

  c.move();
  c.render();
  steps++;
  if(Math.random()<0.1) percentage = pixels(ctx);
  if(percentage>=0.5 && lastPercentage<0.5) {
    lastPercentage = percentage;
    addData(runNumber,steps);
  }
  if(percentage>=0.8 &&lastPercentage<0.8) {
    lastPercentage = percentage;
    addData(runNumber,steps);
  }
  if(percentage>=0.95 && lastPercentage<0.95) {
    lastPercentage = percentage;
    addData(runNumber,steps);
    reset();
  }
}

function pixels(ctx){
  count=0;
  var imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  for (var i=3;i<imgData.data.length;i+=4) if(imgData.data[i]>0)count++;
  return count/(imgData.data.length/4);

}



</script>
</body>
</html>
