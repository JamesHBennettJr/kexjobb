
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
</head>
<body >
<canvas width="200px" height="200px" id="canvas" style="border:solid 1px #000;"></canvas>
<h2>RESULTS</h2>
<p id="res"></p>
<div id="data"></div>
<script src="cleaner.js"></script>
<script src="spiral.js"></script>
<script src="snaking.js"></script>
<script>

var c = null;
function addRobot(){
  c = new Cleaner(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height),6,"#5f1",Math.random()*Math.PI*2, 3);
}
var interval;
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
addRobot();
var max_runs = 2;
var run_count = 0;
var current_p = 0;
var steps = 0;
var last_percentage = 0.01;
var percentage = 0;
var data_storage = [[]];

var refesh_rate = 5;

ctx.fillStyle="#fff";


function addData(data){
  document.getElementById("data").innerHTML += (data + "<br>");
}

function display_data() {
    /*for(var e = 0; e < 95; e++) {
        data_storage[e] = Math.floor(data_storage[e]/max_runs);
        document.write(data_storage[e] + " ");
    }*/
    console.log(data_storage);
}

function restart() {
    if(run_count == max_runs-1) {
        display_data();
    } else {
        addRobot();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        data_storage.push([]);
        run_count++;
        steps = 0;
        last_percentage = 0.01;
        percentage = 0;
        current_p = 0;
        interval = setInterval(run,refesh_rate);
    }
}

function run(){
  c.move();
  c.render();
  steps++;
  percentage = pixels(ctx);
  if(percentage>last_percentage) {
      //addData(steps);
      data_storage[run_count].push(steps);
      last_percentage += 0.01;
      console.log(data_storage[run_count].length);
  }
  if(percentage >= 0.95) {
      clearInterval(interval);
      restart();
  }
}

function pixels(ctx){
  count=0;
  var imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  for (var i=3;i<imgData.data.length;i+=4) if(imgData.data[i]>0)count++;
  return count/(imgData.data.length/4);

}

var interval = setInterval(run,refesh_rate);

</script>
</body>
</html>
